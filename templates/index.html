<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ToonEncodes Runner — Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg1: #0f172a;
    --accent: #ff7eb3;
    --accent2: #7ee7ff;
    --glass: rgba(255,255,255,0.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071029 0%, #11203a 100%);font-family:Poppins,system-ui,Segoe UI,Roboto,Arial}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
  .ui {
    width:920px;
    max-width:96%;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:20px;
    align-items:start;
  }
  .panel {
    background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    border-radius:16px;
    padding:18px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.03);
  }
  canvas {
    width:100%;
    height:600px;
    border-radius:12px;
    display:block;
    background: linear-gradient(#7a9cff06, #0b1e3a 60%);
    box-shadow: 0 12px 30px rgba(2,6,23,0.6), inset 0 -40px 80px rgba(0,0,0,0.35);
  }

  .right {
    padding:10px;
  }
  h1{margin:0 0 8px;font-size:20px;color:#fff}
  .meta{color:#cbd5e1;font-size:13px;margin-bottom:12px}
  .badge {display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,#ff758c,#ff7eb3);color:#fff;font-weight:600;box-shadow:0 6px 18px rgba(255,125,160,0.12)}
  .info-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:12px;border-radius:10px;margin-bottom:12px;color:#e6eef8}
  .row{display:flex;gap:10px;align-items:center}
  button.primary{
    background:linear-gradient(90deg,var(--accent),var(--accent2));border:0;padding:12px 14px;border-radius:10px;color:#051028;font-weight:700;cursor:pointer;
    box-shadow: 0 8px 24px rgba(124,58,237,0.12);
  }
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px;border-radius:8px;color:#dfe8ff;cursor:pointer}
  .small{font-size:13px;color:#b7c6df}

  .dev-block{
    display:flex;gap:12px;align-items:center;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }
  .dev-block img{width:64px;height:64px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,0.04)}
  .dev-name{color:#fff;font-weight:700}
  .copyright{font-size:12px;color:#9fb0d6;margin-top:8px}

  /* overlay/modal */
  .overlay {
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(90deg,rgba(0,0,0,0.45),rgba(0,0,0,0.6));z-index:1000;
  }
  .modal {
    width:94%;max-width:680px;background:linear-gradient(180deg,#071029,#071834);padding:22px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 20px 80px rgba(0,0,0,0.6);
  }
  .modal h2{margin:0 0 10px;color:#fff}
  .modal p{color:#c7d7f2}
  .center{display:flex;align-items:center;justify-content:center;gap:12px}
  input[type=file]{display:block}

  .timer {
    display:inline-block;background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:999px;color:#fff;font-weight:700;margin-left:8px
  }

  /* small responsive */
  @media (max-width:900px){
    .ui{grid-template-columns:1fr;align-items:center}
    canvas{height:420px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="ui">
    <div class="panel">
      <h1>ToonEncodes Runner</h1>
      <div class="meta">A polished demo endless-runner • Free trial: <span class="timer" id="trialTimer">02:00</span></div>

      <canvas id="game" width="900" height="600"></canvas>

      <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
        <button class="primary" id="btnStart">Start / Restart</button>
        <button class="ghost" id="btnPause">Pause</button>
        <div style="flex:1"></div>
        <div class="small">Score: <span id="score">0</span></div>
      </div>

      <div style="margin-top:12px" class="small">Controls: Tap / Click to jump. Swipe left/right or arrow keys to change lanes.</div>
    </div>

    <div class="panel right">
      <div class="info-card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-size:15px;color:#fff;font-weight:700">Developed by Mohanish</div>
            <div class="small">© ToonEncodes</div>
          </div>
          <div class="badge">Demo</div>
        </div>
        <div style="height:10px"></div>
        <div class="dev-block">
          <!-- Place your developer photo as developer.jpg in project folder -->
          <img src="developer.jpg" alt="Developer Photo" id="devPhoto" onerror="this.src='https://via.placeholder.com/64x64?text=M'">
          <div>
            <div class="dev-name">Mohanish</div>
            <div class="small">Game Creator • VFX & UI Designer</div>
            <div class="copyright">ToonEncodes</div>
          </div>
        </div>
      </div>

      <div style="margin-top:14px">
        <div class="info-card">
          <div style="font-weight:700;color:#fff">Game Info</div>
          <div class="small" style="margin-top:8px">
            - Particles & VFX, score pickup, and obstacles.<br>
            - Free play: 2 minutes. After trial ends you will see the Support screen.<br>
            - Upload a screenshot on the Support screen to unlock full 1-hour play (simulated).
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="primary" id="btnHow">How to Share</button>
          <button class="ghost" id="btnAbout">About</button>
        </div>

        <div style="margin-top:12px" id="shareBlock" class="small"></div>
      </div>
    </div>
  </div>
</div>

<!-- Overlay: Support / Unlock modal -->
<div class="overlay" id="overlay">
  <div class="modal">
    <h2>Support & Unlock</h2>
    <p>
      The free trial has ended. Thank you for trying ToonEncodes Runner!
      You can support the developer to unlock the full game for <strong>1 hour</strong>.
    </p>

    <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
      <img src="developer.jpg" alt="dev" style="width:90px;height:90px;border-radius:10px;object-fit:cover;border:1px solid rgba(255,255,255,0.03)" onerror="this.src='https://via.placeholder.com/90x90?text=M'">
      <div>
        <div style="font-weight:700;color:#fff">Mohanish</div>
        <div class="small">Developer — ToonEncodes</div>
        <div style="height:8px"></div>
        <div class="small">Demo Unlock (simulated) • No real money processed</div>
      </div>
    </div>

    <div style="margin-top:16px" class="center">
      <!-- This button simulates a payment dialog, but does not process money -->
      <button class="primary" id="btnSimulatePay">Simulate Payment (Demo)</button>
      <button class="ghost" id="btnUploadSS">Upload Screenshot to Verify</button>
    </div>

    <div style="margin-top:14px" class="small">
      <strong>Note:</strong> This is a demo flow. To implement real payments, integrate a proper merchant/payments SDK (Stripe, Razorpay, etc.) and verify server-side.
    </div>

    <div style="margin-top:14px" class="center">
      <button class="ghost" id="btnCloseOverlay">Close</button>
    </div>

    <div id="uploadArea" style="margin-top:12px;display:none">
      <div class="small">Upload a screenshot (PNG/JPG). This simulates proof of payment for the demo.</div>
      <input type="file" accept="image/*" id="ssFile">
      <div style="height:8px"></div>
      <div class="center">
        <button class="primary" id="btnSubmitSS">Submit Screenshot</button>
      </div>
      <div id="uploadMsg" class="small" style="margin-top:8px;color:#d0f0d6"></div>
    </div>

  </div>
</div>

<script>
/*
  Simple 2D endless runner demo
  - Lanes: 3 lanes (left, center, right)
  - Player automatically moves forward; obstacles and pickups spawn
  - Visual VFX: particle system for pickups + glow
  - Trial timer: 120 seconds (2 min). After that overlay shows.
  - Simulate unlock: if user clicks "Simulate Payment" or uploads an image, unlock for 3600 seconds (1 hour).
  - Local storage key: toon_unlock_until (timestamp in ms)
*/

// ======== Game variables ========
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let W = canvas.width, H = canvas.height;
function resizeCanvas(){
  // Keep internal resolution stable for visuals; canvas element width is fine
  // We use fixed internal resolution; do nothing to keep deterministic physics
}
resizeCanvas();

let running=false, paused=false;
let score = 0;
let speed = 4;
let spawnTimer=0, spawnInterval = 90;
let objects = []; // obstacles and pickups
const lanes = [W*0.25, W*0.5, W*0.75];
let player = {lane:1,x:lanes[1],y:H-140,w:50,h:80,vy:0,groundY:H-140,jet:0};
let particles = [];

// trial & unlock
const TRIAL_SECONDS = 120;
const UNLOCK_SECONDS = 3600;
let trialLeft = TRIAL_SECONDS;
let trialTimerInterval;
const trialTimerEl = document.getElementById('trialTimer');

function formatTime(s){
  const mm = String(Math.floor(s/60)).padStart(2,'0');
  const ss = String(Math.floor(s%60)).padStart(2,'0');
  return `${mm}:${ss}`;
}

function loadUnlock() {
  const val = localStorage.getItem('toon_unlock_until');
  if(!val) return false;
  const until = parseInt(val,10);
  if(Date.now() < until) return true;
  return false;
}
function setUnlockFor(hours){
  const until = Date.now() + hours*3600*1000;
  localStorage.setItem('toon_unlock_until', String(until));
}

// Init trial countdown (only if no active unlock)
function startTrialCountdown(){
  if(loadUnlock()){
    trialLeft = 999999; // indefinite unlocked
    document.getElementById('trialTimer').textContent = 'Unlocked';
    return;
  }
  trialLeft = TRIAL_SECONDS;
  trialTimerEl.textContent = formatTime(trialLeft);
  if(trialTimerInterval) clearInterval(trialTimerInterval);
  trialTimerInterval = setInterval(()=>{
    if(running && !paused){
      trialLeft--;
      if(trialLeft<=0){
        trialLeft=0;
        trialTimerEl.textContent = '00:00';
        // stop gameplay and show overlay
        endTrial();
      } else {
        trialTimerEl.textContent = formatTime(trialLeft);
      }
    }
  }, 1000);
}
startTrialCountdown();

// ======== Input handlers ========
let touchStartX=null;
canvas.addEventListener('pointerdown', (e)=>{
  if(!running) return;
  // jump
  if(playerOnGround()){
    player.vy = -12;
    spawnParticles(player.x, player.y, 15, '#ffdf7a');
  } else {
    // mid-air small hover
    player.vy = Math.max(player.vy, -8);
  }
  touchStartX = e.clientX;
});
canvas.addEventListener('pointerup', (e)=>{
  if(touchStartX!==null){
    const dx = e.clientX - touchStartX;
    if(Math.abs(dx)>40){
      if(dx>0) changeLane(1);
      else changeLane(-1);
    }
  }
  touchStartX=null;
});
document.addEventListener('keydown', (e)=>{
  if(e.key==='ArrowLeft') changeLane(-1);
  if(e.key==='ArrowRight') changeLane(1);
  if(e.key===' ' || e.key==='ArrowUp') {
    if(!running) startGame();
    else {
      if(playerOnGround()) player.vy = -12;
    }
  }
  if(e.key==='p') togglePause();
});

function changeLane(dir){
  player.lane = Math.max(0, Math.min(2, player.lane + dir));
  // animate x
  player.x = lanes[player.lane];
  spawnParticles(player.x, player.y+10, 6, '#7ee7ff');
}
function playerOnGround(){ return player.y >= player.groundY - 0.1; }

// ======== Particles system ========
function spawnParticles(x,y,n,color){
  for(let i=0;i<n;i++){
    particles.push({
      x:x + (Math.random()-0.5)*40,
      y:y + (Math.random()-0.5)*10,
      vx:(Math.random()-0.5)*3,
      vy:- (Math.random()*3+1),
      life: 30 + Math.random()*40,
      color: color
    });
  }
}
function updateParticles(){
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.4;
    p.life--;
    if(p.life<=0) particles.splice(i,1);
  }
}
function drawParticles(ctx){
  particles.forEach(p=>{
    const alpha = Math.max(0, p.life/60);
    ctx.fillStyle = p.color;
    ctx.globalAlpha = alpha;
    ctx.beginPath();
    ctx.arc(p.x, p.y, 3,0,Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;
  });
}

// ======== Objects: obstacles and pickups ========
function spawnObject(){
  const type = Math.random() < 0.7 ? 'obstacle' : 'coin';
  const lane = Math.floor(Math.random()*3);
  const x = lanes[lane];
  const y = -60;
  objects.push({type:type,lane:lane,x:x,y:y,w:50,h:60,scored:false});
}

function updateObjects(){
  for(let i=objects.length-1;i>=0;i--){
    const o = objects[i];
    o.y += speed + (score/200); // speed scales slowly with score
    if(o.y > H+100) objects.splice(i,1);
    // collisions
    if(!o.scored && Math.abs(o.lane - player.lane)===0 && o.y > player.y - 20 && o.y < player.y + 40){
      if(o.type==='coin'){
        score += 10;
        spawnParticles(o.x, o.y, 18, '#ffd166');
        o.scored = true;
        objects.splice(i,1);
      } else if(o.type==='obstacle'){
        // collision -> small penalty
        score = Math.max(0, score - 20);
        spawnParticles(player.x, player.y, 22, '#ff6b6b');
        // bounce back a bit
        player.y -= 10;
        objects.splice(i,1);
      }
    }
  }
}

function drawObjects(ctx){
  objects.forEach(o=>{
    if(o.type==='coin'){
      // glow circle + coin
      const g = ctx.createRadialGradient(o.x, o.y, 0, o.x, o.y, 40);
      g.addColorStop(0, 'rgba(255,215,0,0.9)');
      g.addColorStop(1, 'rgba(255,215,0,0.06)');
      ctx.fillStyle = g;
      ctx.beginPath(); ctx.arc(o.x, o.y, 18,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = '#fff3c4';
      ctx.font = '16px Poppins'; ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText('★', o.x, o.y);
    } else {
      // obstacle: stylized crate
      ctx.fillStyle = '#2b2b3a';
      ctx.fillRect(o.x - 28, o.y - 30, 56, 50);
      ctx.strokeStyle = '#3f3f55';
      ctx.strokeRect(o.x - 28, o.y - 30, 56, 50);
    }
  });
}

// ======== Player update & draw ========
function updatePlayer(){
  player.vy += 0.7; // gravity
  player.y += player.vy;
  if(player.y > player.groundY){
    player.y = player.groundY;
    player.vy = 0;
  }
}
function drawPlayer(ctx){
  // shadow
  ctx.fillStyle = 'rgba(0,0,0,0.25)';
  ctx.beginPath();
  ctx.ellipse(player.x, player.groundY + player.h*0.6, 36, 12, 0, 0, Math.PI*2); ctx.fill();

  // body (rounded)
  const grad = ctx.createLinearGradient(player.x-20, player.y-40, player.x+20, player.y+40);
  grad.addColorStop(0, '#ff758c');
  grad.addColorStop(1, '#ff7eb3');
  ctx.fillStyle = grad;
  roundRect(ctx, player.x-25, player.y-80, 50, 80, 12, true, false);

  // face
  ctx.fillStyle = '#fff';
  ctx.beginPath(); ctx.arc(player.x, player.y-40, 12, 0, Math.PI*2); ctx.fill();
  ctx.fillStyle = '#000'; ctx.fillRect(player.x-6, player.y-42, 3, 3);
  ctx.fillRect(player.x+3, player.y-42, 3, 3);
}

// helper
function roundRect(ctx, x, y, w, h, r, fill, stroke){
  if (typeof stroke === 'undefined') stroke = true;
  if (typeof r === 'undefined') r = 5;
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.arcTo(x+w, y,   x+w, y+h, r);
  ctx.arcTo(x+w, y+h, x,   y+h, r);
  ctx.arcTo(x,   y+h, x,   y,   r);
  ctx.arcTo(x,   y,   x+w, y,   r);
  ctx.closePath();
  if(fill){ctx.fill();}
  if(stroke){ctx.stroke();}
}

// ======== Main loop ========
function gameLoop(){
  ctx.clearRect(0,0,W,H);
  // sky gradient
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#07183a'); g.addColorStop(1,'#091026');
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

  // ground
  ctx.fillStyle = '#071834';
  ctx.fillRect(0,H-120,W,120);
  // road stripes
  ctx.strokeStyle = 'rgba(255,255,255,0.03)'; ctx.lineWidth=2;
  for(let i=0;i<3;i++){
    ctx.beginPath();
    ctx.moveTo(lanes[i]-120,H-60);
    ctx.lineTo(lanes[i]+120,H-60);
    ctx.stroke();
  }

  // VFX: moving faint lines for speed
  for(let i=0;i<18;i++){
    const x = (i*200 + (Date.now()/6 % 200)) % (W+200) - 100;
    ctx.fillStyle = 'rgba(255,255,255,0.02)';
    ctx.fillRect(x, H-160 + (i%3)*10, 6, 2);
  }

  // update/draw objects
  updateObjects();
  drawObjects(ctx);

  // update/draw player
  updatePlayer();
  drawPlayer(ctx);

  // particles
  updateParticles();
  drawParticles(ctx);

  // HUD
  document.getElementById('score').textContent = score;

  // spawn
  spawnTimer++;
  if(spawnTimer > spawnInterval){
    spawnTimer = 0;
    spawnObject();
    // slowly speed up over time
    if(spawnInterval > 36) spawnInterval -= 1;
  }

  if(running && !paused) requestAnimationFrame(gameLoop);
}

// ======== Start / stop ========
function startGame(){
  // check unlock or trial
  if(!loadUnlock() && trialLeft<=0){
    // show overlay to ask for unlock
    showOverlay();
    return;
  }
  // reset
  running = true;
  paused = false;
  score = 0;
  spawnTimer = 0;
  objects = [];
  particles = [];
  player.lane = 1;
  player.x = lanes[1];
  player.y = player.groundY;
  player.vy = 0;
  spawnInterval = 90;
  if(!loadUnlock()){
    // ensure trial countdown starts
    startTrialCountdown();
  } else {
    trialTimerEl.textContent = 'Unlocked';
  }
  requestAnimationFrame(gameLoop);
}

function endTrial(){
  // stop game loop and show overlay
  running = false;
  showOverlay();
}

function togglePause(){
  paused = !paused;
  if(paused){
    document.getElementById('btnPause').textContent = 'Resume';
  } else {
    document.getElementById('btnPause').textContent = 'Pause';
    if(running) requestAnimationFrame(gameLoop);
  }
}

// ======== Overlay & upload handling ========
const overlay = document.getElementById('overlay');
const btnCloseOverlay = document.getElementById('btnCloseOverlay');
const btnSimulatePay = document.getElementById('btnSimulatePay');
const btnUploadSS = document.getElementById('btnUploadSS');
const uploadArea = document.getElementById('uploadArea');
const ssFile = document.getElementById('ssFile');
const btnSubmitSS = document.getElementById('btnSubmitSS');
const uploadMsg = document.getElementById('uploadMsg');

function showOverlay(){ overlay.style.display='flex'; }
function hideOverlay(){ overlay.style.display='none'; }

btnCloseOverlay.addEventListener('click', ()=> hideOverlay());
btnSimulatePay.addEventListener('click', ()=>{
  // This simulates a payment dialog; we will just unlock for 1 hour as demo
  if(confirm('Simulate payment and unlock for 1 hour? (Demo only)')){
    setUnlockFor(1); // 1 hour
    alert('Unlocked for 1 hour (demo). Enjoy!');
    hideOverlay();
    startGame();
  }
});
btnUploadSS.addEventListener('click', ()=>{
  uploadArea.style.display = uploadArea.style.display==='none' ? 'block':'none';
});

btnSubmitSS.addEventListener('click', ()=>{
  const f = ssFile.files[0];
  if(!f){ uploadMsg.textContent = 'Please choose a screenshot file.'; return; }
  // Basic size check (demo)
  if(f.size > 5 * 1024 * 1024){ uploadMsg.textContent = 'File too large (max 5MB).'; return; }
  // Simulate verification: we'll read the image and accept it as proof
  const reader = new FileReader();
  reader.onload = function(ev){
    // store proof locally (not uploaded anywhere)
    localStorage.setItem('toon_ss_proof', ev.target.result);
    setUnlockFor(1); // unlock for 1 hour
    uploadMsg.style.color = '#b0f5c1';
    uploadMsg.textContent = 'Screenshot received — unlocked for 1 hour (demo).';
    setTimeout(()=>{ hideOverlay(); startGame(); }, 900);
  };
  reader.readAsDataURL(f);
});

// How to share
document.getElementById('btnHow').addEventListener('click', ()=>{
  const s = `Share this Replit / site link with others. It runs in any browser. To include your developer photo, upload a file named developer.jpg in the project.`;
  document.getElementById('shareBlock').textContent = s;
});
document.getElementById('btnAbout').addEventListener('click', ()=>{
  alert('ToonEncodes Runner - Demo\nDeveloped by Mohanish\nThis is a demo game with simulated unlock flow.');
});

// start / pause buttons
document.getElementById('btnStart').addEventListener('click', ()=>{ startGame(); });
document.getElementById('btnPause').addEventListener('click', ()=>{ togglePause(); });

// Responsive: recompute lanes on visual width
function recomputeLanes(){
  const rect = canvas.getBoundingClientRect();
  const cw = canvas.width;
  // lanes already set to fixed internal coords; no change needed for demo
}
window.addEventListener('resize', recomputeLanes);

// start initial screen
(function init(){
  player.x = lanes[player.lane];
  // show overlay automatically if trial ended and not unlocked
  if(!loadUnlock() && trialLeft<=0){
    showOverlay();
  }
})();
</script>
</body>
</html>
